# OpenAPI Client Serialization Strategy (2025)

## Overview
This project uses **native Dart serialization** for OpenAPI-generated API clients.  
This is the recommended approach for Flutter/OpenAPI integration in 2025.

## Why Native Serialization?

1. **No build_runner needed** - Faster development, no `.g.dart` files
2. **Maintained by OpenAPI Generator** - Automatic updates with schema changes
3. **Simpler setup** - Just regenerate when backend schema changes
4. **Clear separation** - API models vs app models use different strategies

## Serialization Approaches in This Project

### OpenAPI-Generated API Client (`packages/frontend_easy_api/`)
- **Strategy**: Native Dart serialization
- **Files**: `lib/model/*.dart` (NO `.g.dart` files)
- **Generation**: `make generate` in `frontend_easy/`
- **Manual `toJson`/`fromJson`**: Auto-generated by OpenAPI

### App Models (`lib/features/*/models/`)
- **Strategy**: Freezed + json_serializable  
- **Files**: `*.freezed.dart` and `*.g.dart` files
- **Generation**: `dart run build_runner build --delete-conflicting-outputs`
- **Benefits**: Immutability, copyWith, unions, value equality

## Regenerating API Client

```bash
cd frontend_easy
make generate
```

This will:
1. Copy latest `openapi-schema.yaml` from backend
2. Remove old generated code (`lib/src/`)
3. Generate new client with native serialization
4. Install dependencies

## Common Mistakes to Avoid

❌ **Don't run `build_runner` on OpenAPI package** - It will fail!
❌ **Don't add `@JsonSerializable` to OpenAPI models** - They use native serialization
❌ **Don't mix serialization approaches** - Keep them separate

✅ **Do regenerate when backend schema changes**
✅ **Do use Freezed for your own app models**
✅ **Do keep OpenAPI and app models separate**

## File Structure

```
frontend_easy/
├── packages/
│   └── frontend_easy_api/          # OpenAPI client (native serialization)
│       └── lib/
│           ├── api/                # API classes
│           ├── model/              # Model classes (native serialization)
│           └── auth/               # Auth interceptors
│
└── lib/
    └── features/
        └── */
            └── models/             # App models (freezed + json_serializable)
```

## Troubleshooting

### Error: "Can't find .g.dart file"
- **Cause**: Old generated code with json_serializable references
- **Fix**: Run `make generate` to regenerate with native serialization

### Error: "The method 'getXxxApi' isn't defined"
- **Cause**: OpenAPI schema missing endpoint or tag
- **Fix**: Check backend `openapi-schema.yaml`, regenerate frontend

### Build fails with serialization errors
- **Cause**: Mixed serialization approaches
- **Fix**: Keep OpenAPI (native) and app models (freezed) separate

## References

- [OpenAPI Generator Dart Docs](https://openapi-generator.tech/docs/generators/dart/)
- [Flutter JSON Serialization Best Practices](https://docs.flutter.dev/data-and-backend/serialization/json)
- [Freezed Package](https://pub.dev/packages/freezed)
