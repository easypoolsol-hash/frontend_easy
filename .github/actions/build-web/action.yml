name: Build Flutter Web
description: Build Flutter web app for production (uses cache, no artifacts)

inputs:
  api_base_url:
    description: Backend API base URL (e.g., https://easypool-backend-staging-44387923111.asia-south1.run.app)
    required: false
    default: 'http://localhost:8000'

runs:
  using: composite
  steps:
    - name: Build Flutter web (release)
      shell: bash
      run: |
        echo "ğŸ—ï¸ Building Flutter web..."
        echo "ğŸ”— Backend URL: ${{ inputs.api_base_url }}"
        flutter build web --release --dart-define=API_BASE_URL=${{ inputs.api_base_url }}
        echo "âœ… Build complete"

    - name: Verify build output
      shell: bash
      run: |
        echo "ğŸ” Verifying build output..."
        if [ ! -f "build/web/index.html" ]; then
          echo "âŒ ERROR: index.html not found in build output!"
          exit 1
        fi

        if [ ! -d "build/web/assets" ]; then
          echo "âŒ ERROR: assets directory not found in build output!"
          exit 1
        fi

        echo "âœ… Build verification passed"
        echo ""
        echo "ğŸ“Š Build size:"
        du -sh build/web
        echo ""
        echo "ğŸ“ Build contents:"
        ls -lh build/web/ | head -20
        echo ""
        echo "ğŸ’¡ Build output available at: build/web/"
        echo "ğŸš€ Ready for deployment (no artifact upload - deploying in same job)"
